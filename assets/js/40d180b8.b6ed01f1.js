"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[618],{3905:function(e,n,t){t.d(n,{Zo:function(){return m},kt:function(){return k}});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var p=r.createContext({}),c=function(e){var n=r.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},m=function(e){var n=c(e.components);return r.createElement(p.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},s=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,l=e.originalType,p=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),s=c(t),k=a,d=s["".concat(p,".").concat(k)]||s[k]||u[k]||l;return t?r.createElement(d,o(o({ref:n},m),{},{components:t})):r.createElement(d,o({ref:n},m))}));function k(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var l=t.length,o=new Array(l);o[0]=s;var i={};for(var p in n)hasOwnProperty.call(n,p)&&(i[p]=n[p]);i.originalType=e,i.mdxType="string"==typeof e?e:a,o[1]=i;for(var c=2;c<l;c++)o[c]=t[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}s.displayName="MDXCreateElement"},1317:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return i},contentTitle:function(){return p},metadata:function(){return c},assets:function(){return m},toc:function(){return u},default:function(){return k}});var r=t(7462),a=t(3366),l=(t(7294),t(3905)),o=["components"],i={title:"\u624b\u5199\u7cfb\u5217-\u5b9e\u73b0\u4e00\u4e2a\u94c2\u91d1\u6bb5\u4f4d\u7684 React",date:new Date("2021-07-22T19:11:14.000Z"),tags:["\u524d\u7aef","\u624b\u5199React"]},p=void 0,c={permalink:"/blog/2021/07/22/simple-react",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2021-07-22-simple-react.md",source:"@site/blog/2021-07-22-simple-react.md",title:"\u624b\u5199\u7cfb\u5217-\u5b9e\u73b0\u4e00\u4e2a\u94c2\u91d1\u6bb5\u4f4d\u7684 React",description:"\u4e3a\u4ec0\u4e48\u662f\u94c2\u91d1\u5462\uff0c\u56e0\u4e3a\u548c\u738b\u8005\u8fd8\u6709\u5f88\u8fdc\u7684\u8ddd\u79bb\u3002\u672c\u6587\u4ec5\u5b9e\u73b0\u7b80\u5355\u7248\u672c\u7684 React\uff0c\u53c2\u8003 React 16.8 \u7684\u57fa\u672c\u529f\u80fd\uff0c\u5305\u62ec\u865a\u62df DOM\u3001Fiber\u3001Diff \u7b97\u6cd5\u3001\u51fd\u6570\u5f0f\u7ec4\u4ef6\u3001hooks \u7b49\u3002",date:"2021-07-22T19:11:14.000Z",formattedDate:"July 22, 2021",tags:[{label:"\u524d\u7aef",permalink:"/blog/tags/\u524d\u7aef"},{label:"\u624b\u5199React",permalink:"/blog/tags/\u624b\u5199-react"}],readingTime:29.69,truncated:!1,authors:[],prevItem:{title:"\u5982\u4f55\u53c2\u4e0e\u5927\u578b\u5f00\u6e90\u9879\u76ee-Taro \u5171\u5efa",permalink:"/blog/2021/12/20/how-to-join-Taro"}},m={authorsImageUrls:[]},u=[{value:"1. React Demo",id:"1-react-demo",children:[{value:"1.1 element",id:"11-element",children:[],level:3},{value:"1.2 render",id:"12-render",children:[],level:3}],level:2},{value:"1. createElement\uff08\u865a\u62df DOM\uff09",id:"1-createelement\u865a\u62df-dom",children:[],level:2},{value:"2. render",id:"2-render",children:[],level:2},{value:"3. \u53ef\u4e2d\u65ad\u6e32\u67d3\uff08requestIdleCallback\uff09",id:"3-\u53ef\u4e2d\u65ad\u6e32\u67d3requestidlecallback",children:[],level:2},{value:"4. Fiber",id:"4-fiber",children:[],level:2},{value:"5. \u6e32\u67d3\u63d0\u4ea4\u9636\u6bb5",id:"5-\u6e32\u67d3\u63d0\u4ea4\u9636\u6bb5",children:[],level:2},{value:"6. \u534f\u8c03\uff08diff \u7b97\u6cd5\uff09",id:"6-\u534f\u8c03diff-\u7b97\u6cd5",children:[{value:"1. currentRoot",id:"1-currentroot",children:[],level:3},{value:"2. performUnitOfWork",id:"2-performunitofwork",children:[],level:3},{value:"3. reconcileChildren",id:"3-reconcilechildren",children:[{value:"3.1 \u5f53\u65b0\u65e7 fiber \u7c7b\u578b\u76f8\u540c\u65f6",id:"31-\u5f53\u65b0\u65e7-fiber-\u7c7b\u578b\u76f8\u540c\u65f6",children:[],level:4},{value:"3.2 \u5f53\u65b0\u65e7 fiber \u7c7b\u578b\u4e0d\u540c\uff0c\u4e14\u6709\u65b0\u5143\u7d20\u65f6",id:"32-\u5f53\u65b0\u65e7-fiber-\u7c7b\u578b\u4e0d\u540c\u4e14\u6709\u65b0\u5143\u7d20\u65f6",children:[],level:4},{value:"3.3 \u5f53\u65b0\u65e7 fiber \u7c7b\u578b\u4e0d\u540c\uff0c\u4e14\u6709\u65e7 fiber \u65f6",id:"33-\u5f53\u65b0\u65e7-fiber-\u7c7b\u578b\u4e0d\u540c\u4e14\u6709\u65e7-fiber-\u65f6",children:[],level:4}],level:3},{value:"4. deletions",id:"4-deletions",children:[],level:3},{value:"5. commitWork",id:"5-commitwork",children:[{value:"5.1 PLACEMENT",id:"51-placement",children:[],level:4},{value:"5.2 DELETION",id:"52-deletion",children:[],level:4},{value:"5.3 UPDATE",id:"53-update",children:[],level:4}],level:3}],level:2},{value:"7. \u51fd\u6570\u5f0f\u7ec4\u4ef6",id:"7-\u51fd\u6570\u5f0f\u7ec4\u4ef6",children:[],level:2},{value:"8. hooks",id:"8-hooks",children:[],level:2}],s={toc:u};function k(e){var n=e.components,t=(0,a.Z)(e,o);return(0,l.kt)("wrapper",(0,r.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://img12.360buyimg.com/ling/jfs/t1/190951/39/10504/64205/60d82ae2E380c664f/cbb7c4b34464cce7.png",alt:null})),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u4e3a\u4ec0\u4e48\u662f\u94c2\u91d1\u5462\uff0c\u56e0\u4e3a\u548c\u738b\u8005\u8fd8\u6709\u5f88\u8fdc\u7684\u8ddd\u79bb\u3002\u672c\u6587\u4ec5\u5b9e\u73b0\u7b80\u5355\u7248\u672c\u7684 React\uff0c\u53c2\u8003 React 16.8 \u7684\u57fa\u672c\u529f\u80fd\uff0c\u5305\u62ec\u865a\u62df DOM\u3001Fiber\u3001Diff \u7b97\u6cd5\u3001\u51fd\u6570\u5f0f\u7ec4\u4ef6\u3001hooks \u7b49\u3002")),(0,l.kt)("h1",{id:"\u4e00\u524d\u8a00"},"\u4e00\u3001\u524d\u8a00"),(0,l.kt)("p",null,"\u672c\u6587\u57fa\u4e8e ",(0,l.kt)("a",{parentName:"p",href:"https://pomb.us/build-your-own-react/"},"https://pomb.us/build-your-own-react/")," \u5b9e\u73b0\u7b80\u5355\u7248 React\u3002"),(0,l.kt)("p",null,"\u672c\u6587\u5b66\u4e60\u601d\u8def\u6765\u81ea ",(0,l.kt)("a",{parentName:"p",href:"https://www.bilibili.com/video/BV1Ki4y1u7Vr?t=78z"},"\u5361\u9882-b\u7ad9-React\u6e90\u7801\uff0c\u4f60\u5728\u7b2c\u51e0\u5c42"),"\u3002"),(0,l.kt)("p",null,"\u6a21\u62df\u7684\u7248\u672c\u4e3a React 16.8\u3002"),(0,l.kt)("p",null,"\u5c06\u5b9e\u73b0\u4ee5\u4e0b\u529f\u80fd\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"createElement\uff08\u865a\u62df DOM\uff09"),"\uff1b"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"render"),"\uff1b"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"\u53ef\u4e2d\u65ad\u6e32\u67d3"),"\uff1b"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"Fibers"),"\uff1b"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"Render and Commit Phases")," \uff1b"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"\u534f\u8c03\uff08Diff \u7b97\u6cd5\uff09"),"\uff1b"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"\u51fd\u6570\u7ec4\u4ef6"),"\uff1b"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"hooks"),"\uff1b")),(0,l.kt)("p",null,"\u4e0b\u9762\u4e0a\u6b63\u9910\uff0c\u8bf7\u7ee7\u7eed\u9605\u8bfb\u3002"),(0,l.kt)("h1",{id:"\u4e8c\u51c6\u5907"},"\u4e8c\u3001\u51c6\u5907"),(0,l.kt)("h2",{id:"1-react-demo"},"1. React Demo"),(0,l.kt)("p",null,"\u5148\u6765\u770b\u770b\u4e00\u4e2a\u7b80\u5355\u7684 React Demo\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"const element = <div title=\"foo\">hello</div>\nconst container = document.getElementById('container')\nReactDOM.render(element, container);\n")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u672c\u4f8b\u5b8c\u6574\u6e90\u7801\u89c1\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://github.com/jiaozitang/web-learn-note/blob/main/src/%E6%89%8B%E5%86%99%E7%B3%BB%E5%88%97/React/reactDemo.html"},"reactDemo"))),(0,l.kt)("p",null,"\u5728\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00 reactDemo.html\uff0c\u5c55\u793a\u5982\u4e0b\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e67cf968275e441db891b5530da0171e~tplv-k3u1fbpfcp-watermark.image",alt:"image.png"})),(0,l.kt)("p",null,"\u6211\u4eec\u9700\u8981\u5b9e\u73b0\u81ea\u5df1\u7684 React\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u77e5\u9053\u4e0a\u9762\u7684\u4ee3\u7801\u5230\u5e95\u505a\u4e86\u4ec0\u4e48\u3002"),(0,l.kt)("h3",{id:"11-element"},"1.1 element"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"const element = <div>123</div>")," \u5b9e\u9645\u4e0a\u662f JSX \u8bed\u6cd5\u3002"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://zh-hans.reactjs.org/docs/glossary.html#jsx"},"React \u5b98\u7f51")," \u5bf9 JSX \u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"JSX \u662f\u4e00\u4e2a JavaScript \u8bed\u6cd5\u6269\u5c55\u3002\u5b83\u7c7b\u4f3c\u4e8e\u6a21\u677f\u8bed\u8a00\uff0c\u4f46\u5b83\u5177\u6709 JavaScript \u7684\u5168\u90e8\u80fd\u529b\u3002JSX \u6700\u7ec8\u4f1a\u88ab babel \u7f16\u8bd1\u4e3a React.createElement() \u51fd\u6570\u8c03\u7528\u3002")),(0,l.kt)("p",null,"\u901a\u8fc7 ",(0,l.kt)("a",{parentName:"p",href:"https://www.babeljs.cn/repl"},"babel \u5728\u7ebf\u7f16\u8bd1")," ",(0,l.kt)("inlineCode",{parentName:"p"},"const element = <div>123</div>")," \u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/006372da0fb7468e9155bc8d69448b48~tplv-k3u1fbpfcp-watermark.image",alt:"image.png"})),(0,l.kt)("p",null,"\u53ef\u77e5 ",(0,l.kt)("inlineCode",{parentName:"p"},"const element = <div>123</div>")," \u7ecf\u8fc7\u7f16\u8bd1\u540e\u7684\u5b9e\u9645\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'const element = React.createElement("div", {\n  title: "foo"\n}, "hello");\n')),(0,l.kt)("p",null,"\u518d\u6765\u770b\u770b\u4e0a\u6587\u7684 React.createElement \u5b9e\u9645\u751f\u6210\u4e86\u4e00\u4e2a\u600e\u4e48\u6837\u7684\u5bf9\u8c61\u3002"),(0,l.kt)("p",null,"\u5728 demo \u4e2d\u6253\u5370\u8bd5\u8bd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"const element = <div title=\"foo\">hello</div>\nconsole.log(element)\nconst container = document.getElementById('container')\nReactDOM.render(element, container);\n")),(0,l.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\u8f93\u51fa\u7684 element \u5982\u4e0b\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7b0e14c7e8734456891b2264cd160476~tplv-k3u1fbpfcp-watermark.image",alt:"image.png"})),(0,l.kt)("p",null,"\u7b80\u5316\u4e00\u4e0b element\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"const element = {\n    type: 'div',\n    props: {\n        title: 'foo',\n        children: 'hello'\n    }\n}\n")),(0,l.kt)("p",null,"\u7b80\u5355\u603b\u7ed3\u4e00\u4e0b\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"React.createElement")," \u5b9e\u9645\u4e0a\u662f\u751f\u6210\u4e86\u4e00\u4e2a element \u5bf9\u8c61\uff0c\u8be5\u5bf9\u8c61\u62e5\u6709\u4ee5\u4e0b\u5c5e\u6027\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"type: \u6807\u7b7e\u540d"),(0,l.kt)("li",{parentName:"ul"},"props",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"title: \u6807\u7b7e\u5c5e\u6027"),(0,l.kt)("li",{parentName:"ul"},"children: \u5b50\u8282\u70b9")))),(0,l.kt)("h3",{id:"12-render"},"1.2 render"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"ReactDOM.render()")," \u5c06 element \u6dfb\u52a0\u5230 id \u4e3a container \u7684 DOM \u8282\u70b9\u4e2d\uff0c\u4e0b\u9762\u6211\u4eec\u5c06\u7b80\u5355\u624b\u5199\u4e00\u4e2a\u65b9\u6cd5\u4ee3\u66ff ",(0,l.kt)("inlineCode",{parentName:"p"},"ReactDOM.render()"),"\u3002"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u521b\u5efa\u6807\u7b7e\u540d\u4e3a element.type \u7684\u8282\u70b9\uff1b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"const node = document.createElement(element.type)\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"\u8bbe\u7f6e node \u8282\u70b9\u7684 title \u4e3a element.props.title\uff1b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'node["title"] = element.props.title\n')),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"\u521b\u5efa\u4e00\u4e2a\u7a7a\u7684\u6587\u672c\u8282\u70b9 text\uff1b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'const text = document.createTextNode("")\n')),(0,l.kt)("ol",{start:4},(0,l.kt)("li",{parentName:"ol"},"\u8bbe\u7f6e\u6587\u672c\u8282\u70b9\u7684 nodeValue \u4e3a element.props.children\uff1b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'text["nodeValue"] = element.props.children\n')),(0,l.kt)("ol",{start:5},(0,l.kt)("li",{parentName:"ol"},"\u5c06\u6587\u672c\u8282\u70b9 text \u6dfb\u52a0\u8fdb node \u8282\u70b9\uff1b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"node.appendChild(text)\n")),(0,l.kt)("ol",{start:6},(0,l.kt)("li",{parentName:"ol"},"\u5c06 node \u8282\u70b9\u6dfb\u52a0\u8fdb container \u8282\u70b9")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"container.appendChild(node)\n")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u672c\u4f8b\u5b8c\u6574\u6e90\u7801\u89c1\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://github.com/jiaozitang/web-learn-note/blob/main/src/%E6%89%8B%E5%86%99%E7%B3%BB%E5%88%97/React/reactDemo2.html"},"reactDemo2"))),(0,l.kt)("p",null,"\u8fd0\u884c\u6e90\u7801\uff0c\u7ed3\u679c\u5982\u4e0b\uff0c\u548c\u5f15\u5165 React \u7684\u7ed3\u679c\u4e00\u81f4\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8033485bbe0a46e6b8f32c5f69315429~tplv-k3u1fbpfcp-watermark.image",alt:"image.png"})),(0,l.kt)("h1",{id:"\u4e09\u5f00\u59cb"},"\u4e09\u3001\u5f00\u59cb"),(0,l.kt)("p",null,"\u4e0a\u6587\u901a\u8fc7\u6a21\u62df React\uff0c\u7b80\u5355\u4ee3\u66ff\u4e86 React.createElement\u3001ReactDOM.render \u65b9\u6cd5\uff0c\u63a5\u4e0b\u6765\u5c06\u771f\u6b63\u5f00\u59cb\u5b9e\u73b0 React \u7684\u5404\u4e2a\u529f\u80fd\u3002"),(0,l.kt)("h2",{id:"1-createelement\u865a\u62df-dom"},"1. createElement\uff08\u865a\u62df DOM\uff09"),(0,l.kt)("p",null,"\u4e0a\u9762\u6709\u4e86\u89e3\u5230 createElement \u7684\u4f5c\u7528\u662f\u521b\u5efa\u4e00\u4e2a element \u5bf9\u8c61\uff0c\u7ed3\u6784\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u865a\u62df DOM \u7ed3\u6784\nconst element = {\n    type: 'div', // \u6807\u7b7e\u540d\n    props: { // \u8282\u70b9\u5c5e\u6027\uff0c\u5305\u542b children\n        title: 'foo', // title \u5c5e\u6027\n        children: 'hello' // \u5b50\u8282\u70b9\uff0c\u6ce8\uff1a\u5b9e\u9645\u4e0a\u8fd9\u91cc\u5e94\u8be5\u662f\u6570\u7ec4\u7ed3\u6784\uff0c\u5e2e\u52a9\u6211\u4eec\u5b58\u50a8\u66f4\u591a\u5b50\u8282\u70b9\n    }\n}\n")),(0,l.kt)("p",null,"\u6839\u636e element \u7684\u7ed3\u6784\uff0c\u8bbe\u8ba1\u4e86 createElement \u51fd\u6570\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"/**\n * \u521b\u5efa\u865a\u62df DOM \u7ed3\u6784\n * @param {type} \u6807\u7b7e\u540d\n * @param {props} \u5c5e\u6027\u5bf9\u8c61\n * @param {children} \u5b50\u8282\u70b9\n * @return {element} \u865a\u62df DOM\n */\nfunction createElement (type, props, ...children) {\n    return {\n        type,\n        props: {\n            ...props,\n            children: children.map(child => \n                typeof child === 'object'\n                ? child\n                : createTextElement(child)\n            )\n        }\n    }\n}\n")),(0,l.kt)("p",null,"\u8fd9\u91cc\u6709\u8003\u8651\u5230\uff0c\u5f53 children \u662f\u975e\u5bf9\u8c61\u65f6\uff0c\u5e94\u8be5\u521b\u5efa\u4e00\u4e2a textElement \u5143\u7d20\uff0c \u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'/**\n * \u521b\u5efa\u6587\u672c\u8282\u70b9\n * @param {text} \u6587\u672c\u503c\n * @return {element} \u865a\u62df DOM\n */\nfunction createTextElement (text) {\n    return {\n        type: "TEXT_ELEMENT",\n        props: {\n            nodeValue: text,\n            children: []\n        }\n    }\n}\n')),(0,l.kt)("p",null,"\u63a5\u4e0b\u6765\u8bd5\u4e00\u4e0b\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'const myReact = {\n    createElement\n}\nconst element = myReact.createElement(\n  "div",\n  { id: "foo" },\n  myReact.createElement("a", null, "bar"),\n  myReact.createElement("b")\n)\nconsole.log(element)\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u672c\u4f8b\u5b8c\u6574\u6e90\u7801\u89c1\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://github.com/jiaozitang/web-learn-note/blob/main/src/%E6%89%8B%E5%86%99%E7%B3%BB%E5%88%97/React/reactDemo3.html"},"reactDemo3"))),(0,l.kt)("p",null,"\u5f97\u5230\u7684 element \u5bf9\u8c61\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'const element = {\n    "type": "div", \n    "props": {\n        "id": "foo", \n        "children": [\n            {\n                "type": "a", \n                "props": {\n                    "children": [\n                        {\n                            "type": "TEXT_ELEMENT", \n                            "props": {\n                                "nodeValue": "bar", \n                                "children": [ ]\n                            }\n                        }\n                    ]\n                }\n            }, \n            {\n                "type": "b", \n                "props": {\n                    "children": [ ]\n                }\n            }\n        ]\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"JSX")),(0,l.kt)("p",null,"\u5b9e\u9645\u4e0a\u6211\u4eec\u5728\u4f7f\u7528 react \u5f00\u53d1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5e76\u4e0d\u4f1a\u8fd9\u6837\u521b\u5efa\u7ec4\u4ef6\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'const element = myReact.createElement(\n  "div",\n  { id: "foo" },\n  myReact.createElement("a", null, "bar"),\n  myReact.createElement("b")\n)\n')),(0,l.kt)("p",null,"\u800c\u662f\u901a\u8fc7 JSX \u8bed\u6cd5\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"const element = (\n    <div id='foo'>\n        <a>bar</a>\n        <b></b>\n    </div>\n)\n")),(0,l.kt)("p",null,"\u5728 myReact \u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u6dfb\u52a0\u6ce8\u91ca\u7684\u5f62\u5f0f\uff0c\u544a\u8bc9 babel \u8f6c\u8bd1\u6211\u4eec\u6307\u5b9a\u7684\u51fd\u6570\uff0c\u6765\u4f7f\u7528 JSX \u8bed\u6cd5\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"/** @jsx myReact.createElement */\nconst element = (\n    <div id='foo'>\n        <a>bar</a>\n        <b></b>\n    </div>\n)\n")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u672c\u4f8b\u5b8c\u6574\u6e90\u7801\u89c1\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://github.com/jiaozitang/web-learn-note/blob/main/src/%E6%89%8B%E5%86%99%E7%B3%BB%E5%88%97/React/reactDemo4.html"},"reactDemo4"))),(0,l.kt)("h2",{id:"2-render"},"2. render"),(0,l.kt)("p",null,"render \u51fd\u6570\u5e2e\u52a9\u6211\u4eec\u5c06 element \u6dfb\u52a0\u81f3\u771f\u5b9e\u8282\u70b9\u4e2d\u3002"),(0,l.kt)("p",null,"\u5c06\u5206\u4e3a\u4ee5\u4e0b\u6b65\u9aa4\u5b9e\u73b0\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u521b\u5efa element.type \u7c7b\u578b\u7684 dom \u8282\u70b9\uff0c\u5e76\u6dfb\u52a0\u81f3\u5bb9\u5668\u4e2d\uff1b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"/**\n * \u5c06\u865a\u62df DOM \u6dfb\u52a0\u81f3\u771f\u5b9e DOM\n * @param {element} \u865a\u62df DOM\n * @param {container} \u771f\u5b9e DOM\n */\nfunction render (element, container) {\n    const dom = document.createElement(element.type)\n    container.appendChild(dom)\n}\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"\u5c06 element.children \u90fd\u6dfb\u52a0\u81f3 dom \u8282\u70b9\u4e2d\uff1b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"element.props.children.forEach(child => \n    render(child, dom)\n)\n")),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"\u5bf9\u6587\u672c\u8282\u70b9\u8fdb\u884c\u7279\u6b8a\u5904\u7406\uff1b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"const dom = element.type === 'TEXT_ELEMENT'\n    ? document.createTextNode(\"\")\n    : document.createElement(element.type)\n")),(0,l.kt)("ol",{start:4},(0,l.kt)("li",{parentName:"ol"},"\u5c06 element \u7684 props \u5c5e\u6027\u6dfb\u52a0\u81f3 dom\uff1b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'const isProperty = key => key !== "children"\nObject.keys(element.props)\n    .filter(isProperty)\n    .forEach(name => {\n      dom[name] = element.props[name]\n})\n')),(0,l.kt)("p",null,"\u4ee5\u4e0a\u6211\u4eec\u5b9e\u73b0\u4e86\u5c06 JSX \u6e32\u67d3\u5230\u771f\u5b9e DOM \u7684\u529f\u80fd\uff0c\u63a5\u4e0b\u6765\u8bd5\u4e00\u4e0b\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"const myReact = {\n    createElement,\n    render\n}\n/** @jsx myReact.createElement */\nconst element = (\n    <div id='foo'>\n        <a>bar</a>\n        <b></b>\n    </div>\n)\n\nmyReact.render(element, document.getElementById('container'))\n")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u672c\u4f8b\u5b8c\u6574\u6e90\u7801\u89c1\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://github.com/jiaozitang/web-learn-note/blob/main/src/%E6%89%8B%E5%86%99%E7%B3%BB%E5%88%97/React/reactDemo5.html"},"reactDemo5"))),(0,l.kt)("p",null,"\u7ed3\u679c\u5982\u56fe\uff0c\u6210\u529f\u8f93\u51fa\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fe4fe623e02e41d2bd81957c0019f12b~tplv-k3u1fbpfcp-watermark.image",alt:"image.png"})),(0,l.kt)("h2",{id:"3-\u53ef\u4e2d\u65ad\u6e32\u67d3requestidlecallback"},"3. \u53ef\u4e2d\u65ad\u6e32\u67d3\uff08requestIdleCallback\uff09"),(0,l.kt)("p",null,"\u518d\u6765\u770b\u770b\u4e0a\u9762\u5199\u7684 render \u65b9\u6cd5\u4e2d\u5173\u4e8e\u5b50\u8282\u70b9\u7684\u5904\u7406\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"/**\n * \u5c06\u865a\u62df DOM \u6dfb\u52a0\u81f3\u771f\u5b9e DOM\n * @param {element} \u865a\u62df DOM\n * @param {container} \u771f\u5b9e DOM\n */\nfunction render (element, container) {\n    // \u7701\u7565\n    // \u904d\u5386\u6240\u6709\u5b50\u8282\u70b9\uff0c\u5e76\u8fdb\u884c\u6e32\u67d3\n    element.props.children.forEach(child =>\n        render(child, dom)\n    )\n    // \u7701\u7565\n}\n")),(0,l.kt)("p",null,"\u8fd9\u4e2a\u9012\u5f52\u8c03\u7528\u662f\u6709\u95ee\u9898\u7684\uff0c\u4e00\u65e6\u5f00\u59cb\u6e32\u67d3\uff0c\u5c31\u4f1a\u5c06\u6240\u6709\u8282\u70b9\u53ca\u5176\u5b50\u8282\u70b9\u5168\u90e8\u6e32\u67d3\u5b8c\u6210\u8fd9\u4e2a\u8fdb\u7a0b\u624d\u4f1a\u7ed3\u675f\u3002"),(0,l.kt)("p",null,"\u5f53 dom tree \u5f88\u5927\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u6e32\u67d3\u8fc7\u7a0b\u4e2d\uff0c\u9875\u9762\u4e0a\u662f\u5361\u4f4f\u7684\u72b6\u6001\uff0c\u65e0\u6cd5\u8fdb\u884c\u7528\u6237\u8f93\u5165\u7b49\u4ea4\u4e92\u64cd\u4f5c\u3002"),(0,l.kt)("p",null,"\u53ef\u5206\u4e3a\u4ee5\u4e0b\u6b65\u9aa4\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u5141\u8bb8\u4e2d\u65ad\u6e32\u67d3\u5de5\u4f5c\uff0c\u5982\u679c\u6709\u4f18\u5148\u7ea7\u66f4\u9ad8\u7684\u5de5\u4f5c\u63d2\u5165\uff0c\u5219\u6682\u65f6\u4e2d\u65ad\u6d4f\u89c8\u5668\u6e32\u67d3\uff0c\u5f85\u5b8c\u6210\u8be5\u5de5\u4f5c\u540e\uff0c\u6062\u590d\u6d4f\u89c8\u5668\u6e32\u67d3\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u5c06\u6e32\u67d3\u5de5\u4f5c\u8fdb\u884c\u5206\u89e3\uff0c\u5206\u89e3\u6210\u4e00\u4e2a\u4e2a\u5c0f\u5355\u5143\uff1b")),(0,l.kt)("p",null,"\u4f7f\u7528 requestIdleCallback \u6765\u89e3\u51b3\u5141\u8bb8\u4e2d\u65ad\u6e32\u67d3\u5de5\u4f5c\u7684\u95ee\u9898\u3002"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback"},"window.requestIdleCallback")," \u5c06\u5728\u6d4f\u89c8\u5668\u7684\u7a7a\u95f2\u65f6\u6bb5\u5185\u8c03\u7528\u7684\u51fd\u6570\u6392\u961f\u3002\u8fd9\u4f7f\u5f00\u53d1\u8005\u80fd\u591f\u5728\u4e3b\u4e8b\u4ef6\u5faa\u73af\u4e0a\u6267\u884c\u540e\u53f0\u548c\u4f4e\u4f18\u5148\u7ea7\u5de5\u4f5c\uff0c\u800c\u4e0d\u4f1a\u5f71\u54cd\u5ef6\u8fdf\u5173\u952e\u4e8b\u4ef6\uff0c\u5982\u52a8\u753b\u548c\u8f93\u5165\u54cd\u5e94\u3002"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"window.requestIdleCallback \u8be6\u7ec6\u4ecb\u7ecd\u53ef\u67e5\u770b\u6587\u6863\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback"},"\u6587\u6863"))),(0,l.kt)("p",null,"\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u4e0b\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\nlet nextUnitOfWork = null\n/**\n * workLoop \u5de5\u4f5c\u5faa\u73af\u51fd\u6570\n * @param {deadline} \u622a\u6b62\u65f6\u95f4\n */\nfunction workLoop(deadline) {\n  // \u662f\u5426\u5e94\u8be5\u505c\u6b62\u5de5\u4f5c\u5faa\u73af\u51fd\u6570\n  let shouldYield = false\n  \n  // \u5982\u679c\u5b58\u5728\u4e0b\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\uff0c\u4e14\u6ca1\u6709\u4f18\u5148\u7ea7\u66f4\u9ad8\u7684\u5176\u4ed6\u5de5\u4f5c\u65f6\uff0c\u5faa\u73af\u6267\u884c\n  while (nextUnitOfWork && !shouldYield) {\n    nextUnitOfWork = performUnitOfWork(\n      nextUnitOfWork\n    )\n    \n    // \u5982\u679c\u622a\u6b62\u65f6\u95f4\u5feb\u5230\u4e86\uff0c\u505c\u6b62\u5de5\u4f5c\u5faa\u73af\u51fd\u6570\n    shouldYield = deadline.timeRemaining() < 1\n  }\n  \n  // \u901a\u77e5\u6d4f\u89c8\u5668\uff0c\u7a7a\u95f2\u65f6\u95f4\u5e94\u8be5\u6267\u884c workLoop\n  requestIdleCallback(workLoop)\n}\n// \u901a\u77e5\u6d4f\u89c8\u5668\uff0c\u7a7a\u95f2\u65f6\u95f4\u5e94\u8be5\u6267\u884c workLoop\nrequestIdleCallback(workLoop)\n\n// \u6267\u884c\u5355\u5143\u4e8b\u4ef6\uff0c\u5e76\u8fd4\u56de\u4e0b\u4e00\u4e2a\u5355\u5143\u4e8b\u4ef6\nfunction performUnitOfWork(nextUnitOfWork) {\n  // TODO\n}\n")),(0,l.kt)("p",null,"performUnitOfWork \u662f\u7528\u6765\u6267\u884c\u5355\u5143\u4e8b\u4ef6\uff0c\u5e76\u8fd4\u56de\u4e0b\u4e00\u4e2a\u5355\u5143\u4e8b\u4ef6\u7684\uff0c\u5177\u4f53\u5b9e\u73b0\u5c06\u5728\u4e0b\u6587\u4ecb\u7ecd\u3002"),(0,l.kt)("h2",{id:"4-fiber"},"4. Fiber"),(0,l.kt)("p",null,"\u4e0a\u6587\u4ecb\u7ecd\u4e86\u901a\u8fc7 requestIdleCallback \u8ba9\u6d4f\u89c8\u5668\u5728\u7a7a\u95f2\u65f6\u95f4\u6e32\u67d3\u5de5\u4f5c\u5355\u5143\uff0c\u907f\u514d\u6e32\u67d3\u8fc7\u4e45\u5bfc\u81f4\u9875\u9762\u5361\u987f\u7684\u95ee\u9898\u3002"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u6ce8\uff1a\u5b9e\u9645\u4e0a requestIdleCallback \u529f\u80fd\u5e76\u4e0d\u7a33\u5b9a\uff0c\u4e0d\u5efa\u8bae\u7528\u4e8e\u751f\u4ea7\u73af\u5883\uff0c\u672c\u4f8b\u4ec5\u7528\u4e8e\u6a21\u62df React \u7684\u601d\u8def\uff0cReact \u672c\u8eab\u5e76\u4e0d\u662f\u901a\u8fc7 requestIdleCallback \u6765\u5b9e\u73b0\u8ba9\u6d4f\u89c8\u5668\u5728\u7a7a\u95f2\u65f6\u95f4\u6e32\u67d3\u5de5\u4f5c\u5355\u5143\u7684\u3002")),(0,l.kt)("p",null,"\u53e6\u4e00\u65b9\u9762\uff0c\u4e3a\u4e86\u8ba9\u6e32\u67d3\u5de5\u4f5c\u53ef\u4ee5\u5206\u79bb\u6210\u4e00\u4e2a\u4e2a\u5c0f\u5355\u5143\uff0cReact \u8bbe\u8ba1\u4e86 fiber\u3002"),(0,l.kt)("p",null,"\u6bcf\u4e00\u4e2a element \u90fd\u662f\u4e00\u4e2a fiber \u7ed3\u6784\uff0c\u6bcf\u4e00\u4e2a fiber \u90fd\u662f\u4e00\u4e2a\u6e32\u67d3\u5de5\u4f5c\u5355\u5143\u3002"),(0,l.kt)("p",null,"\u6240\u4ee5 ",(0,l.kt)("strong",{parentName:"p"},"fiber \u65e2\u662f\u4e00\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u4e5f\u662f\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143"),"\u3002"),(0,l.kt)("p",null,"\u4e0b\u6587\u5c06\u901a\u8fc7\u7b80\u5355\u7684\u793a\u4f8b\u5bf9 fiber \u8fdb\u884c\u4ecb\u7ecd\u3002"),(0,l.kt)("p",null,"\u5047\u8bbe\u9700\u8981\u6e32\u67d3\u8fd9\u6837\u4e00\u4e2a element \u6811\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"myReact.render(\n  <div>\n    <h1>\n      <p />\n      <a />\n    </h1>\n    <h2 />\n  </div>,\n  container\n)\n")),(0,l.kt)("p",null,"\u751f\u6210\u7684 fiber tree \u5982\u56fe\uff1a"),(0,l.kt)("p",null,"\u6a59\u8272\u4ee3\u8868\u5b50\u8282\u70b9\uff0c\u9ec4\u8272\u4ee3\u8868\u7236\u8282\u70b9\uff0c\u84dd\u8272\u4ee3\u8868\u5144\u5f1f\u8282\u70b9\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a92a6b184ca4456aab76a73cff2ca4a3~tplv-k3u1fbpfcp-watermark.image",alt:"image.png"})),(0,l.kt)("p",null,"\u6bcf\u4e2a fiber \u90fd\u6709\u4e00\u4e2a\u94fe\u63a5\u6307\u5411\u5b83\u7684\u7b2c\u4e00\u4e2a\u5b50\u8282\u70b9\u3001\u4e0b\u4e00\u4e2a\u5144\u5f1f\u8282\u70b9\u548c\u5b83\u7684\u7236\u8282\u70b9\u3002\u8fd9\u79cd\u6570\u636e\u7ed3\u6784\u53ef\u4ee5\u8ba9\u6211\u4eec\u66f4\u65b9\u4fbf\u7684\u67e5\u627e\u4e0b\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\u3002"),(0,l.kt)("p",null,"\u4e0a\u56fe\u7684\u7bad\u5934\u4e5f\u8868\u660e\u4e86 fiber \u7684\u6e32\u67d3\u8fc7\u7a0b\uff0c\u6e32\u67d3\u8fc7\u7a0b\u8be6\u7ec6\u63cf\u8ff0\u5982\u4e0b\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u4ece root \u5f00\u59cb\uff0c\u627e\u5230\u7b2c\u4e00\u4e2a\u5b50\u8282\u70b9 div\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u627e\u5230 div \u7684\u7b2c\u4e00\u4e2a\u5b50\u8282\u70b9 h1\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u627e\u5230 h1 \u7684\u7b2c\u4e00\u4e2a\u5b50\u8282\u70b9 p\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u627e p \u7684\u7b2c\u4e00\u4e2a\u5b50\u8282\u70b9\uff0c",(0,l.kt)("strong",{parentName:"li"},"\u5982\u65e0\u5b50\u8282\u70b9\uff0c\u5219\u627e\u4e0b\u4e00\u4e2a\u5144\u5f1f\u8282\u70b9"),"\uff0c\u627e\u5230 p \u7684\u5144\u5f1f\u8282\u70b9 a\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u627e a \u7684\u7b2c\u4e00\u4e2a\u5b50\u8282\u70b9\uff0c",(0,l.kt)("strong",{parentName:"li"},"\u5982\u65e0\u5b50\u8282\u70b9\uff0c\u4e5f\u65e0\u5144\u5f1f\u8282\u70b9\uff0c\u5219\u627e\u5b83\u7684\u7236\u8282\u70b9\u7684\u4e0b\u4e00\u4e2a\u5144\u5f1f\u8282\u70b9"),"\uff0c\u627e\u5230 a \u7684 \u7236\u8282\u70b9\u7684\u5144\u5f1f\u8282\u70b9 h2\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u627e h2 \u7684\u7b2c\u4e00\u4e2a\u5b50\u8282\u70b9\uff0c\u627e\u4e0d\u5230\uff0c\u627e\u5144\u5f1f\u8282\u70b9\uff0c\u627e\u4e0d\u5230\uff0c\u627e\u7236\u8282\u70b9 div \u7684\u5144\u5f1f\u8282\u70b9\uff0c\u4e5f\u627e\u4e0d\u5230\uff0c\u7ee7\u7eed\u627e div \u7684\u7236\u8282\u70b9\u7684\u5144\u5f1f\u8282\u70b9\uff0c\u627e\u5230 root\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u7b2c 6 \u6b65\u5df2\u7ecf\u627e\u5230\u4e86 root \u8282\u70b9\uff0c\u6e32\u67d3\u5df2\u5168\u90e8\u5b8c\u6210\u3002")),(0,l.kt)("p",null,"\u4e0b\u9762\u5c06\u6e32\u67d3\u8fc7\u7a0b\u7528\u4ee3\u7801\u5b9e\u73b0\u3002"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u5c06 render \u4e2d\u521b\u5efa DOM \u8282\u70b9\u7684\u90e8\u5206\u62bd\u79bb\u4e3a creactDOM \u51fd\u6570\uff1b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'/**\n * createDom \u521b\u5efa DOM \u8282\u70b9\n * @param {fiber} fiber \u8282\u70b9\n * @return {dom} dom \u8282\u70b9\n */\nfunction createDom (fiber) {\n    // \u5982\u679c\u662f\u6587\u672c\u7c7b\u578b\uff0c\u521b\u5efa\u7a7a\u7684\u6587\u672c\u8282\u70b9\uff0c\u5982\u679c\u4e0d\u662f\u6587\u672c\u7c7b\u578b\uff0c\u6309 type \u7c7b\u578b\u521b\u5efa\u8282\u70b9\n    const dom = fiber.type === \'TEXT_ELEMENT\'\n        ? document.createTextNode("")\n        : document.createElement(fiber.type)\n\n    // isProperty \u8868\u793a\u4e0d\u662f children \u7684\u5c5e\u6027\n    const isProperty = key => key !== "children"\n    \n    // \u904d\u5386 props\uff0c\u4e3a dom \u6dfb\u52a0\u5c5e\u6027\n    Object.keys(fiber.props)\n        .filter(isProperty)\n        .forEach(name => {\n            dom[name] = fiber.props[name]\n        })\n        \n    // \u8fd4\u56de dom\n    return dom\n}\n')),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"\u5728 render \u4e2d\u8bbe\u7f6e\u7b2c\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\u4e3a fiber \u6839\u8282\u70b9\uff1b")),(0,l.kt)("p",null,"fiber \u6839\u8282\u70b9\u4ec5\u5305\u542b children \u5c5e\u6027\uff0c\u503c\u4e3a\u53c2\u6570 fiber\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u4e0b\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\nlet nextUnitOfWork = null\n/**\n * \u5c06 fiber \u6dfb\u52a0\u81f3\u771f\u5b9e DOM\n * @param {element} fiber\n * @param {container} \u771f\u5b9e DOM\n */\nfunction render (element, container) {\n    nextUnitOfWork = {\n        dom: container,\n        props: {\n            children: [element]\n        }\n    }\n}\n")),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"\u901a\u8fc7 requestIdleCallback \u5728\u6d4f\u89c8\u5668\u7a7a\u95f2\u65f6\uff0c\u6e32\u67d3 fiber\uff1b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"/**\n * workLoop \u5de5\u4f5c\u5faa\u73af\u51fd\u6570\n * @param {deadline} \u622a\u6b62\u65f6\u95f4\n */\nfunction workLoop(deadline) {\n  // \u662f\u5426\u5e94\u8be5\u505c\u6b62\u5de5\u4f5c\u5faa\u73af\u51fd\u6570\n  let shouldYield = false\n  \n  // \u5982\u679c\u5b58\u5728\u4e0b\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\uff0c\u4e14\u6ca1\u6709\u4f18\u5148\u7ea7\u66f4\u9ad8\u7684\u5176\u4ed6\u5de5\u4f5c\u65f6\uff0c\u5faa\u73af\u6267\u884c\n  while (nextUnitOfWork && !shouldYield) {\n    nextUnitOfWork = performUnitOfWork(\n      nextUnitOfWork\n    )\n    \n    // \u5982\u679c\u622a\u6b62\u65f6\u95f4\u5feb\u5230\u4e86\uff0c\u505c\u6b62\u5de5\u4f5c\u5faa\u73af\u51fd\u6570\n    shouldYield = deadline.timeRemaining() < 1\n  }\n  \n  // \u901a\u77e5\u6d4f\u89c8\u5668\uff0c\u7a7a\u95f2\u65f6\u95f4\u5e94\u8be5\u6267\u884c workLoop\n  requestIdleCallback(workLoop)\n}\n// \u901a\u77e5\u6d4f\u89c8\u5668\uff0c\u7a7a\u95f2\u65f6\u95f4\u5e94\u8be5\u6267\u884c workLoop\nrequestIdleCallback(workLoop)\n")),(0,l.kt)("ol",{start:4},(0,l.kt)("li",{parentName:"ol"},"\u6e32\u67d3 fiber \u7684\u51fd\u6570 performUnitOfWork\uff1b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"/**\n * performUnitOfWork \u5904\u7406\u5de5\u4f5c\u5355\u5143\n * @param {fiber} fiber\n * @return {nextUnitOfWork} \u4e0b\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\n */\nfunction performUnitOfWork(fiber) {\n  // TODO \u6dfb\u52a0 dom \u8282\u70b9\n  // TODO \u65b0\u5efa filber\n  // TODO \u8fd4\u56de\u4e0b\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\uff08fiber\uff09\n}\n")),(0,l.kt)("p",null,"4.1 \u6dfb\u52a0 dom \u8282\u70b9"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"function performUnitOfWork(fiber) {\n    // \u5982\u679c fiber \u6ca1\u6709 dom \u8282\u70b9\uff0c\u4e3a\u5b83\u521b\u5efa\u4e00\u4e2a dom \u8282\u70b9\n    if (!fiber.dom) {\n        fiber.dom = createDom(fiber)\n    }\n\n    // \u5982\u679c fiber \u6709\u7236\u8282\u70b9\uff0c\u5c06 fiber.dom \u6dfb\u52a0\u81f3\u7236\u8282\u70b9\n    if (fiber.parent) {\n        fiber.parent.dom.appendChild(fiber.dom)\n    }\n}\n")),(0,l.kt)("p",null,"4.2 \u65b0\u5efa filber"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"function performUnitOfWork(fiber) {\n    // \uff5e\uff5e\u7701\u7565\uff5e\uff5e\n    // \u5b50\u8282\u70b9\n    const elements = fiber.props.children\n    // \u7d22\u5f15\n    let index = 0\n    // \u4e0a\u4e00\u4e2a\u5144\u5f1f\u8282\u70b9\n    let prevSibling = null\n    // \u904d\u5386\u5b50\u8282\u70b9\n    while (index < elements.length) {\n        const element = elements[index]\n\n        // \u521b\u5efa fiber\n        const newFiber = {\n            type: element.type,\n            props: element.props,\n            parent: fiber,\n            dom: null,\n        }\n\n        // \u5c06\u7b2c\u4e00\u4e2a\u5b50\u8282\u70b9\u8bbe\u7f6e\u4e3a fiber \u7684\u5b50\u8282\u70b9\n        if (index === 0) {\n            fiber.child = newFiber\n        } else if (element) {\n        // \u7b2c\u4e00\u4e2a\u4e4b\u5916\u7684\u5b50\u8282\u70b9\u8bbe\u7f6e\u4e3a\u8be5\u8282\u70b9\u7684\u5144\u5f1f\u8282\u70b9\n            prevSibling.sibling = newFiber\n        }\n\n        prevSibling = newFiber\n        index++\n    }\n}\n")),(0,l.kt)("p",null,"4.3 \u8fd4\u56de\u4e0b\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\uff08fiber\uff09"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"\nfunction performUnitOfWork(fiber) {\n    // \uff5e\uff5e\u7701\u7565\uff5e\uff5e\n    // \u5982\u679c\u6709\u5b50\u8282\u70b9\uff0c\u8fd4\u56de\u5b50\u8282\u70b9\n    if (fiber.child) {\n        return fiber.child\n    }\n    let nextFiber = fiber\n    while (nextFiber) {\n        // \u5982\u679c\u6709\u5144\u5f1f\u8282\u70b9\uff0c\u8fd4\u56de\u5144\u5f1f\u8282\u70b9\n        if (nextFiber.sibling) {\n            return nextFiber.sibling\n        }\n\n        // \u5426\u5219\u7ee7\u7eed\u8d70 while \u5faa\u73af\uff0c\u76f4\u5230\u627e\u5230 root\u3002\n        nextFiber = nextFiber.parent\n    }\n}\n")),(0,l.kt)("p",null,"\u4ee5\u4e0a\u6211\u4eec\u5b9e\u73b0\u4e86\u5c06 fiber \u6e32\u67d3\u5230\u9875\u9762\u7684\u529f\u80fd\uff0c\u4e14\u6e32\u67d3\u8fc7\u7a0b\u662f\u53ef\u4e2d\u65ad\u7684\u3002"),(0,l.kt)("p",null,"\u73b0\u5728\u8bd5\u4e00\u4e0b\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"const element = (\n    <div>\n        <h1>\n        <p />\n        <a />\n        </h1>\n        <h2 />\n    </div>\n)\n\nmyReact.render(element, document.getElementById('container'))\n")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u672c\u4f8b\u5b8c\u6574\u6e90\u7801\u89c1\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://github.com/jiaozitang/web-learn-note/blob/main/src/%E6%89%8B%E5%86%99%E7%B3%BB%E5%88%97/React/reactDemo7.html"},"reactDemo7"))),(0,l.kt)("p",null,"\u5982\u9884\u671f\u8f93\u51fa dom\uff0c\u5982\u56fe\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/18c3cea8e3b042ebbf2f10eaffd9a18b~tplv-k3u1fbpfcp-watermark.image",alt:"image.png"})),(0,l.kt)("h2",{id:"5-\u6e32\u67d3\u63d0\u4ea4\u9636\u6bb5"},"5. \u6e32\u67d3\u63d0\u4ea4\u9636\u6bb5"),(0,l.kt)("p",null,"\u7531\u4e8e\u6e32\u67d3\u8fc7\u7a0b\u88ab\u6211\u4eec\u505a\u4e86\u53ef\u4e2d\u65ad\u7684\uff0c\u90a3\u4e48\u4e2d\u65ad\u7684\u65f6\u5019\uff0c\u6211\u4eec\u80af\u5b9a\u4e0d\u5e0c\u671b\u6d4f\u89c8\u5668\u7ed9\u7528\u6237\u5c55\u793a\u7684\u662f\u6e32\u67d3\u4e86\u4e00\u534a\u7684 UI\u3002"),(0,l.kt)("p",null,"\u5bf9\u6e32\u67d3\u63d0\u4ea4\u9636\u6bb5\u4f18\u5316\u7684\u5904\u7406\u5982\u4e0b\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u628a performUnitOfWork \u4e2d\u5173\u4e8e\u628a\u5b50\u8282\u70b9\u6dfb\u52a0\u81f3\u7236\u8282\u70b9\u7684\u903b\u8f91\u5220\u9664\uff1b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"function performUnitOfWork(fiber) {\n    // \u628a\u8fd9\u6bb5\u5220\u4e86\n    if (fiber.parent) {\n       fiber.parent.dom.appendChild(fiber.dom)\n    }\n}\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"\u65b0\u589e\u4e00\u4e2a\u6839\u8282\u70b9\u53d8\u91cf\uff0c\u5b58\u50a8 fiber \u6839\u8282\u70b9\uff1b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u6839\u8282\u70b9\nlet wipRoot = null\nfunction render (element, container) {\n    wipRoot = {\n        dom: container,\n        props: {\n            children: [element]\n        }\n    }\n    // \u4e0b\u4e00\u4e2a\u5de5\u4f5c\u5355\u5143\u662f\u6839\u8282\u70b9\n    nextUnitOfWork = wipRoot\n}\n")),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"\u5f53\u6240\u6709 fiber \u90fd\u5de5\u4f5c\u5b8c\u6210\u65f6\uff0cnextUnitOfWork \u4e3a undefined\uff0c\u8fd9\u65f6\u518d\u6e32\u67d3\u771f\u5b9e DOM\uff1b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"function workLoop (deadline) {\n    // \u7701\u7565\n    if (!nextUnitOfWork && wipRoot) {\n        commitRoot()\n    }\n    // \u7701\u7565\n}\n")),(0,l.kt)("ol",{start:4},(0,l.kt)("li",{parentName:"ol"},"\u65b0\u589e commitRoot \u51fd\u6570\uff0c\u6267\u884c\u6e32\u67d3\u771f\u5b9e DOM \u64cd\u4f5c\uff0c\u9012\u5f52\u5c06 fiber tree \u6e32\u67d3\u4e3a\u771f\u5b9e DOM\uff1b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u5168\u90e8\u5de5\u4f5c\u5355\u5143\u5b8c\u6210\u540e\uff0c\u5c06 fiber tree \u6e32\u67d3\u4e3a\u771f\u5b9e DOM\uff1b\nfunction commitRoot () {\n    commitWork(wipRoot.child)\n    // \u9700\u8981\u8bbe\u7f6e\u4e3a null\uff0c\u5426\u5219 workLoop \u5728\u6d4f\u89c8\u5668\u7a7a\u95f2\u65f6\u4e0d\u65ad\u7684\u6267\u884c\u3002\n    wipRoot = null\n}\n/**\n * performUnitOfWork \u5904\u7406\u5de5\u4f5c\u5355\u5143\n * @param {fiber} fiber\n */\nfunction commitWork (fiber) {\n    if (!fiber) return\n    const domParent = fiber.parent.dom\n    domParent.appendChild(fiber.dom)\n    // \u6e32\u67d3\u5b50\u8282\u70b9\n    commitWork(fiber.child)\n    // \u6e32\u67d3\u5144\u5f1f\u8282\u70b9\n    commitWork(fiber.sibling)\n}\n")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u672c\u4f8b\u5b8c\u6574\u6e90\u7801\u89c1\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://github.com/jiaozitang/web-learn-note/blob/main/src/%E6%89%8B%E5%86%99%E7%B3%BB%E5%88%97/React/reactDemo8.html"},"reactDemo8"))),(0,l.kt)("p",null,"\u6e90\u7801\u8fd0\u884c\u7ed3\u679c\u5982\u56fe\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cccbab6b83a24ca3a9c45470ff9b37a0~tplv-k3u1fbpfcp-watermark.image",alt:"image.png"})),(0,l.kt)("h2",{id:"6-\u534f\u8c03diff-\u7b97\u6cd5"},"6. \u534f\u8c03\uff08diff \u7b97\u6cd5\uff09"),(0,l.kt)("p",null,"\u5f53 element \u6709\u66f4\u65b0\u65f6\uff0c\u9700\u8981\u5c06\u66f4\u65b0\u524d\u7684 fiber tree \u548c\u66f4\u65b0\u540e\u7684 fiber tree \u8fdb\u884c\u6bd4\u8f83\uff0c\u5f97\u5230\u6bd4\u8f83\u7ed3\u679c\u540e\uff0c\u4ec5\u5bf9\u6709\u53d8\u5316\u7684 fiber \u5bf9\u5e94\u7684 dom \u8282\u70b9\u8fdb\u884c\u66f4\u65b0\u3002"),(0,l.kt)("p",null,"\u901a\u8fc7\u534f\u8c03\uff0c\u51cf\u5c11\u5bf9\u771f\u5b9e DOM \u7684\u64cd\u4f5c\u6b21\u6570\u3002"),(0,l.kt)("h3",{id:"1-currentroot"},"1. currentRoot"),(0,l.kt)("p",null,"\u65b0\u589e currentRoot \u53d8\u91cf\uff0c\u4fdd\u5b58\u6839\u8282\u70b9\u66f4\u65b0\u524d\u7684 fiber tree\uff0c\u4e3a fiber \u65b0\u589e alternate \u5c5e\u6027\uff0c\u4fdd\u5b58 fiber \u66f4\u65b0\u524d\u7684 fiber tree\uff1b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"let currentRoot = null\nfunction render (element, container) {\n    wipRoot = {\n        // \u7701\u7565\n        alternate: currentRoot\n    }\n}\nfunction commitRoot () {\n    commitWork(wipRoot.child)\n    currentRoot = wipRoot\n    wipRoot = null\n}\n")),(0,l.kt)("h3",{id:"2-performunitofwork"},"2. performUnitOfWork"),(0,l.kt)("p",null,"\u5c06 performUnitOfWork \u4e2d\u5173\u4e8e\u65b0\u5efa fiber \u7684\u903b\u8f91\uff0c\u62bd\u79bb\u5230 reconcileChildren \u51fd\u6570\uff1b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"/**\n * \u534f\u8c03\u5b50\u8282\u70b9\n * @param {fiber} fiber\n * @param {elements} fiber \u7684 \u5b50\u8282\u70b9\n */\nfunction reconcileChildren (fiber, elements) {\n    // \u7528\u4e8e\u7edf\u8ba1\u5b50\u8282\u70b9\u7684\u7d22\u5f15\u503c\n    let index = 0\n    // \u4e0a\u4e00\u4e2a\u5144\u5f1f\u8282\u70b9\n    let prevSibling = null\n\n    // \u904d\u5386\u5b50\u8282\u70b9\n    while (index < elements.length) {\n        const element = elements[index]\n\n        // \u65b0\u5efa fiber\n        const newFiber = {\n            type: element.type,\n            props: element.props,\n            parent: fiber,\n            dom: null,\n        }\n\n        // fiber\u7684\u7b2c\u4e00\u4e2a\u5b50\u8282\u70b9\u662f\u5b83\u7684\u5b50\u8282\u70b9\n        if (index === 0) {\n            fiber.child = newFiber\n        } else if (element) {\n        // fiber \u7684\u5176\u4ed6\u5b50\u8282\u70b9\uff0c\u662f\u5b83\u7b2c\u4e00\u4e2a\u5b50\u8282\u70b9\u7684\u5144\u5f1f\u8282\u70b9\n            prevSibling.sibling = newFiber\n        }\n\n        // \u628a\u65b0\u5efa\u7684 newFiber \u8d4b\u503c\u7ed9 prevSibling\uff0c\u8fd9\u6837\u5c31\u65b9\u4fbf\u4e3a newFiber \u6dfb\u52a0\u5144\u5f1f\u8282\u70b9\u4e86\n        prevSibling = newFiber\n        \n        // \u7d22\u5f15\u503c + 1\n        index++\n    }\n}\n")),(0,l.kt)("h3",{id:"3-reconcilechildren"},"3. reconcileChildren"),(0,l.kt)("p",null,"\u5728 reconcileChildren \u4e2d\u5bf9\u6bd4\u65b0\u65e7 fiber\uff1b"),(0,l.kt)("h4",{id:"31-\u5f53\u65b0\u65e7-fiber-\u7c7b\u578b\u76f8\u540c\u65f6"},"3.1 \u5f53\u65b0\u65e7 fiber \u7c7b\u578b\u76f8\u540c\u65f6"),(0,l.kt)("p",null,"\u4fdd\u7559 dom\uff0c\u4ec5\u66f4\u65b0 props\uff0c\u8bbe\u7f6e effectTag \u4e3a UPDATE\uff1b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'function reconcileChildren (wipFiber, elements) {\n    // \uff5e\uff5e\u7701\u7565\uff5e\uff5e\n    // oldFiber \u53ef\u4ee5\u5728 wipFiber.alternate \u4e2d\u627e\u5230\n    let oldFiber = wipFiber.alternate && wipFiber.alternate.child\n\n    while (index < elements.length || oldFiber != null) {\n        const element = elements[index]\n        let newFiber = null\n\n        // fiber \u7c7b\u578b\u662f\u5426\u76f8\u540c\n        const sameType =\n            oldFiber &&\n            element &&\n            element.type == oldFiber.type\n\n        // \u5982\u679c\u7c7b\u578b\u76f8\u540c\uff0c\u4ec5\u66f4\u65b0 props\n        if (sameType) {\n            newFiber = {\n                type: oldFiber.type,\n                props: element.props,\n                dom: oldFiber.dom,\n                parent: wipFiber,\n                alternate: oldFiber,\n                effectTag: "UPDATE",\n            }\n        }\n        // \uff5e\uff5e\u7701\u7565\uff5e\uff5e\n    }\n    // \uff5e\uff5e\u7701\u7565\uff5e\uff5e\n}\n')),(0,l.kt)("h4",{id:"32-\u5f53\u65b0\u65e7-fiber-\u7c7b\u578b\u4e0d\u540c\u4e14\u6709\u65b0\u5143\u7d20\u65f6"},"3.2 \u5f53\u65b0\u65e7 fiber \u7c7b\u578b\u4e0d\u540c\uff0c\u4e14\u6709\u65b0\u5143\u7d20\u65f6"),(0,l.kt)("p",null,"\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 dom \u8282\u70b9\uff0c\u8bbe\u7f6e effectTag \u4e3a PLACEMENT\uff1b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'function reconcileChildren (wipFiber, elements) {\n    // \uff5e\uff5e\u7701\u7565\uff5e\uff5e\n    if (element && !sameType) {\n        newFiber = {\n            type: element.type,\n            props: element.props,\n            dom: null,\n            parent: wipFiber,\n            alternate: null,\n            effectTag: "PLACEMENT",\n        }\n    }\n    // \uff5e\uff5e\u7701\u7565\uff5e\uff5e\n}\n')),(0,l.kt)("h4",{id:"33-\u5f53\u65b0\u65e7-fiber-\u7c7b\u578b\u4e0d\u540c\u4e14\u6709\u65e7-fiber-\u65f6"},"3.3 \u5f53\u65b0\u65e7 fiber \u7c7b\u578b\u4e0d\u540c\uff0c\u4e14\u6709\u65e7 fiber \u65f6"),(0,l.kt)("p",null,"\u5220\u9664\u65e7 fiber\uff0c\u8bbe\u7f6e effectTag \u4e3a DELETION\uff1b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'function reconcileChildren (wipFiber, elements) {\n    // \uff5e\uff5e\u7701\u7565\uff5e\uff5e\n    if (oldFiber && !sameType) {\n        oldFiber.effectTag = "DELETION"\n        deletions.push(oldFiber)\n    }\n    // \uff5e\uff5e\u7701\u7565\uff5e\uff5e\n}\n')),(0,l.kt)("h3",{id:"4-deletions"},"4. deletions"),(0,l.kt)("p",null,"\u65b0\u5efa deletions \u6570\u7ec4\u5b58\u50a8\u9700\u5220\u9664\u7684 fiber \u8282\u70b9\uff0c\u6e32\u67d3 DOM \u65f6\uff0c\u904d\u5386 deletions \u5220\u9664\u65e7 fiber\uff1b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"let deletions = null\nfunction render (element, container) {\n    // \u7701\u7565\n    // render \u65f6\uff0c\u521d\u59cb\u5316 deletions \u6570\u7ec4\n    deletions = []\n}\n\n// \u6e32\u67d3 DOM \u65f6\uff0c\u904d\u5386 deletions \u5220\u9664\u65e7 fiber\nfunction commitRoot () {\n    deletions.forEach(commitWork)\n}\n")),(0,l.kt)("h3",{id:"5-commitwork"},"5. commitWork"),(0,l.kt)("p",null,"\u5728 commitWork \u4e2d\u5bf9 fiber \u7684 effectTag \u8fdb\u884c\u5224\u65ad\uff0c\u5e76\u5206\u522b\u5904\u7406\u3002"),(0,l.kt)("h4",{id:"51-placement"},"5.1 PLACEMENT"),(0,l.kt)("p",null,"\u5f53 fiber \u7684 effectTag \u4e3a PLACEMENT \u65f6\uff0c\u8868\u793a\u662f\u65b0\u589e fiber\uff0c\u5c06\u8be5\u8282\u70b9\u65b0\u589e\u81f3\u7236\u8282\u70b9\u4e2d\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'if (\n    fiber.effectTag === "PLACEMENT" &&\n    fiber.dom != null\n) {\n    domParent.appendChild(fiber.dom)\n}\n')),(0,l.kt)("h4",{id:"52-deletion"},"5.2 DELETION"),(0,l.kt)("p",null,"\u5f53 fiber \u7684 effectTag \u4e3a DELETION \u65f6\uff0c\u8868\u793a\u662f\u5220\u9664 fiber\uff0c\u5c06\u7236\u8282\u70b9\u7684\u8be5\u8282\u70b9\u5220\u9664\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'else if (fiber.effectTag === "DELETION") {\n    domParent.removeChild(fiber.dom)\n}\n')),(0,l.kt)("h4",{id:"53-update"},"5.3 UPDATE"),(0,l.kt)("p",null,"\u5f53 fiber \u7684 effectTag \u4e3a UPDATE \u65f6\uff0c\u8868\u793a\u662f\u66f4\u65b0 fiber\uff0c\u66f4\u65b0 props \u5c5e\u6027\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"else if (fiber.effectTag === 'UPDATE' && fiber.dom != null) {\n    updateDom(fiber.dom, fiber.alternate.props, fiber.props)\n}\n")),(0,l.kt)("p",null,"updateDom \u51fd\u6570\u6839\u636e\u4e0d\u540c\u7684\u66f4\u65b0\u7c7b\u578b\uff0c\u5bf9 props \u5c5e\u6027\u8fdb\u884c\u66f4\u65b0\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'const isProperty = key => key !== "children"\n\n// \u662f\u5426\u662f\u65b0\u5c5e\u6027\nconst isNew = (prev, next) => key => prev[key] !== next[key]\n\n// \u662f\u5426\u662f\u65e7\u5c5e\u6027\nconst isGone = (prev, next) => key => !(key in next)\n\nfunction updateDom(dom, prevProps, nextProps) {\n    // \u5220\u9664\u65e7\u5c5e\u6027\n    Object.keys(prevProps)\n        .filter(isProperty)\n        .filter(isGone(prevProps, nextProps))\n        .forEach(name => {\n            dom[name] = ""\n        })\n\n    // \u66f4\u65b0\u65b0\u5c5e\u6027\n    Object.keys(nextProps)\n        .filter(isProperty)\n        .filter(isNew(prevProps, nextProps))\n        .forEach(name => {\n            dom[name] = nextProps[name]\n        })\n}\n')),(0,l.kt)("p",null,"\u53e6\u5916\uff0c\u4e3a updateDom \u6dfb\u52a0\u4e8b\u4ef6\u5c5e\u6027\u7684\u66f4\u65b0\u3001\u5220\u9664\uff0c\u4fbf\u4e8e\u8ffd\u8e2a fiber \u4e8b\u4ef6\u7684\u66f4\u65b0\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'function updateDom(dom, prevProps, nextProps) {\n    // \uff5e\uff5e\u7701\u7565\uff5e\uff5e\n    const isEvent = key => key.startsWith("on")\n    //\u5220\u9664\u65e7\u7684\u6216\u8005\u6709\u53d8\u5316\u7684\u4e8b\u4ef6\n    Object.keys(prevProps)\n        .filter(isEvent)\n        .filter(\n          key =>\n            !(key in nextProps) ||\n            isNew(prevProps, nextProps)(key)\n        )\n        .forEach(name => {\n          const eventType = name\n            .toLowerCase()\n            .substring(2)\n          dom.removeEventListener(\n            eventType,\n            prevProps[name]\n          )\n        })\n\n    // \u6ce8\u518c\u65b0\u4e8b\u4ef6\n    Object.keys(nextProps)\n        .filter(isEvent)\n        .filter(isNew(prevProps, nextProps))\n        .forEach(name => {\n        const eventType = name\n            .toLowerCase()\n            .substring(2)\n        dom.addEventListener(\n            eventType,\n            nextProps[name]\n        )\n    })\n    // \uff5e\uff5e\u7701\u7565\uff5e\uff5e\n}\n')),(0,l.kt)("p",null,"\u66ff\u6362 creactDOM \u4e2d\u8bbe\u7f6e props \u7684\u903b\u8f91\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"function createDom (fiber) {\n    const dom = fiber.type === 'TEXT_ELEMENT'\n        ? document.createTextNode(\"\")\n        : document.createElement(fiber.type)\n    // \u770b\u8fd9\u91cc\u9e2d\n    updateDom(dom, {}, fiber.props)\n    return dom\n}\n")),(0,l.kt)("p",null,"\u65b0\u5efa\u4e00\u4e2a\u5305\u542b\u8f93\u5165\u8868\u5355\u9879\u7684\u4f8b\u5b50\uff0c\u5c1d\u8bd5\u66f4\u65b0 element\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'/** @jsx myReact.createElement */\nconst container = document.getElementById("container")\n\nconst updateValue = e => {\n    rerender(e.target.value)\n}\n\nconst rerender = value => {\n    const element = (\n        <div>\n            <input onInput={updateValue} value={value} />\n            <h2>Hello {value}</h2>\n        </div>\n    )\n    myReact.render(element, container)\n}\n\nrerender("World")\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u672c\u4f8b\u5b8c\u6574\u6e90\u7801\u89c1\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://github.com/jiaozitang/web-learn-note/blob/main/src/%E6%89%8B%E5%86%99%E7%B3%BB%E5%88%97/React/reactDemo9.html"},"reactDemo9"))),(0,l.kt)("p",null,"\u8f93\u51fa\u7ed3\u679c\u5982\u56fe\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e615196850b244c3930771375d93ba3c~tplv-k3u1fbpfcp-watermark.image",alt:"12.gif"})),(0,l.kt)("h2",{id:"7-\u51fd\u6570\u5f0f\u7ec4\u4ef6"},"7. \u51fd\u6570\u5f0f\u7ec4\u4ef6"),(0,l.kt)("p",null,"\u5148\u6765\u770b\u4e00\u4e2a\u7b80\u5355\u7684\u51fd\u6570\u5f0f\u7ec4\u4ef6\u793a\u4f8b\uff1a"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"myReact \u8fd8\u4e0d\u652f\u6301\u51fd\u6570\u5f0f\u7ec4\u4ef6\uff0c\u4e0b\u9762\u4ee3\u7801\u8fd0\u884c\u4f1a\u62a5\u9519\uff0c\u8fd9\u91cc\u4ec5\u7528\u4e8e\u6bd4\u7167\u51fd\u6570\u5f0f\u7ec4\u4ef6\u7684\u5e38\u89c4\u4f7f\u7528\u65b9\u5f0f\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"/** @jsx myReact.createElement */\nconst container = document.getElementById(\"container\")\n\nfunction App (props) {\n    return (\n        <h1>hi~ {props.name}</h1>\n    )\n}\n\nconst element = (\n    <App name='foo' />\n)\n\nmyReact.render(element, container)\n")),(0,l.kt)("p",null,"\u51fd\u6570\u5f0f\u7ec4\u4ef6\u548c html \u6807\u7b7e\u7ec4\u4ef6\u76f8\u6bd4\uff0c\u6709\u4ee5\u4e0b\u4e24\u70b9\u4e0d\u540c\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u51fd\u6570\u7ec4\u4ef6\u7684 fiber \u6ca1\u6709 dom \u8282\u70b9\uff1b"),(0,l.kt)("li",{parentName:"ul"},"\u51fd\u6570\u7ec4\u4ef6\u7684 children \u9700\u8981\u8fd0\u884c\u51fd\u6570\u540e\u5f97\u5230\uff1b")),(0,l.kt)("p",null,"\u901a\u8fc7\u4e0b\u5217\u6b65\u9aa4\u5b9e\u73b0\u51fd\u6570\u7ec4\u4ef6\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u4fee\u6539 performUnitOfWork\uff0c\u6839\u636e fiber \u7c7b\u578b\uff0c\u6267\u884c fiber \u5de5\u4f5c\u5355\u5143\uff1b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"function performUnitOfWork(fiber) {\n    // \u662f\u5426\u662f\u51fd\u6570\u7c7b\u578b\u7ec4\u4ef6\n    const isFunctionComponent = fiber && fiber.type && fiber.type instanceof Function\n    // \u5982\u679c\u662f\u51fd\u6570\u7ec4\u4ef6\uff0c\u6267\u884c updateFunctionComponent \u51fd\u6570\n    if (isFunctionComponent) {\n        updateFunctionComponent(fiber)\n    } else {\n    // \u5982\u679c\u4e0d\u662f\u51fd\u6570\u7ec4\u4ef6\uff0c\u6267\u884c updateHostComponent \u51fd\u6570\n        updateHostComponent(fiber)\n    }\n    // \u7701\u7565\n}\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"\u5b9a\u4e49 updateHostComponent \u51fd\u6570\uff0c\u6267\u884c\u975e\u51fd\u6570\u7ec4\u4ef6\uff1b")),(0,l.kt)("p",null,"\u975e\u51fd\u6570\u5f0f\u7ec4\u4ef6\u53ef\u76f4\u63a5\u5c06 fiber.props.children \u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"function updateHostComponent(fiber) {\n    if (!fiber.dom) {\n        fiber.dom = createDom(fiber)\n    }\n    reconcileChildren(fiber, fiber.props.children)\n}\n")),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"\u5b9a\u4e49 updateFunctionComponent \u51fd\u6570\uff0c\u6267\u884c\u51fd\u6570\u7ec4\u4ef6\uff1b")),(0,l.kt)("p",null,"\u51fd\u6570\u7ec4\u4ef6\u9700\u8981\u8fd0\u884c\u6765\u83b7\u5f97 fiber.children\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"function updateFunctionComponent(fiber) {\n    // fiber.type \u5c31\u662f\u51fd\u6570\u7ec4\u4ef6\u672c\u8eab\uff0cfiber.props \u5c31\u662f\u51fd\u6570\u7ec4\u4ef6\u7684\u53c2\u6570\n    const children = [fiber.type(fiber.props)]\n    reconcileChildren(fiber, children)\n}\n")),(0,l.kt)("ol",{start:4},(0,l.kt)("li",{parentName:"ol"},"\u4fee\u6539 commitWork \u51fd\u6570\uff0c\u517c\u5bb9\u6ca1\u6709 dom \u8282\u70b9\u7684 fiber\uff1b")),(0,l.kt)("p",null,"4.1 \u4fee\u6539 domParent \u7684\u83b7\u53d6\u903b\u8f91\uff0c\u901a\u8fc7 while \u5faa\u73af\u4e0d\u65ad\u5411\u4e0a\u5bfb\u627e\uff0c\u76f4\u5230\u627e\u5230\u6709 dom \u8282\u70b9\u7684\u7236 fiber\uff1b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"function commitWork (fiber) {\n    // \u7701\u7565\n    let domParentFiber = fiber.parent\n    // \u5982\u679c fiber.parent \u6ca1\u6709 dom \u8282\u70b9\uff0c\u5219\u7ee7\u7eed\u627e fiber.parent.parent.dom\uff0c\u76f4\u5230\u6709 dom \u8282\u70b9\u3002\n    while (!domParentFiber.dom) {\n        domParentFiber = domParentFiber.parent\n    }\n    const domParent = domParentFiber.dom\n    // \u7701\u7565\n}\n")),(0,l.kt)("p",null,"4.2 \u4fee\u6539\u5220\u9664\u8282\u70b9\u7684\u903b\u8f91\uff0c\u5f53\u5220\u9664\u8282\u70b9\u65f6\uff0c\u9700\u8981\u4e0d\u65ad\u5411\u4e0b\u5bfb\u627e\uff0c\u76f4\u5230\u627e\u5230\u6709 dom \u8282\u70b9\u7684\u5b50 fiber\uff1b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'function commitWork (fiber) {\n    // \u7701\u7565\n    // \u5982\u679c fiber \u7684\u66f4\u65b0\u7c7b\u578b\u662f\u5220\u9664\uff0c\u6267\u884c commitDeletion\n     else if (fiber.effectTag === "DELETION") {\n        commitDeletion(fiber.dom, domParent)\n    }\n    // \u7701\u7565\n}\n\n// \u5220\u9664\u8282\u70b9\nfunction commitDeletion (fiber, domParent) {\n    // \u5982\u679c\u8be5 fiber \u6709 dom \u8282\u70b9\uff0c\u76f4\u63a5\u5220\u9664\n    if (fiber.dom) {\n        domParent.removeChild(fiber.dom)\n    } else {\n    // \u5982\u679c\u8be5 fiber \u6ca1\u6709 dom \u8282\u70b9\uff0c\u5219\u7ee7\u7eed\u627e\u5b83\u7684\u5b50\u8282\u70b9\u8fdb\u884c\u5220\u9664\n        commitDeletion(fiber.child, domParent)\n    }\n}\n')),(0,l.kt)("p",null,"\u4e0b\u9762\u8bd5\u4e00\u4e0b\u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"/** @jsx myReact.createElement */\nconst container = document.getElementById(\"container\")\n\nfunction App (props) {\n    return (\n        <h1>hi~ {props.name}</h1>\n    )\n}\n\nconst element = (\n    <App name='foo' />\n)\n\nmyReact.render(element, container)\n")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u672c\u4f8b\u5b8c\u6574\u6e90\u7801\u89c1\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://github.com/jiaozitang/web-learn-note/blob/main/src/%E6%89%8B%E5%86%99%E7%B3%BB%E5%88%97/React/reactDemo10.html"},"reactDemo10"))),(0,l.kt)("p",null,"\u8fd0\u884c\u7ed3\u679c\u5982\u56fe\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a920eb5c41974c15b2db269dc95cb7f9~tplv-k3u1fbpfcp-watermark.image",alt:"image.png"})),(0,l.kt)("h2",{id:"8-hooks"},"8. hooks"),(0,l.kt)("p",null,"\u4e0b\u9762\u7ee7\u7eed\u4e3a myReact \u6dfb\u52a0\u7ba1\u7406\u72b6\u6001\u7684\u529f\u80fd\uff0c\u671f\u671b\u662f\u51fd\u6570\u7ec4\u4ef6\u62e5\u6709\u81ea\u5df1\u7684\u72b6\u6001\uff0c\u4e14\u53ef\u4ee5\u83b7\u53d6\u3001\u66f4\u65b0\u72b6\u6001\u3002"),(0,l.kt)("p",null,"\u4e00\u4e2a\u62e5\u6709\u8ba1\u6570\u529f\u80fd\u7684\u51fd\u6570\u7ec4\u4ef6\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"function Counter() {\n    const [state, setState] = myReact.useState(1)\n    return (\n        <h1 onClick={() => setState(c => c + 1)}>\n        Count: {state}\n        </h1>\n    )\n}\nconst element = <Counter />\n")),(0,l.kt)("p",null,"\u5df2\u77e5\u9700\u8981\u4e00\u4e2a useState \u65b9\u6cd5\u7528\u6765\u83b7\u53d6\u3001\u66f4\u65b0\u72b6\u6001\u3002"),(0,l.kt)("p",null,"\u8fd9\u91cc\u518d\u91cd\u7533\u4e00\u4e0b\uff0c",(0,l.kt)("strong",{parentName:"p"},"\u6e32\u67d3\u51fd\u6570\u7ec4\u4ef6\u7684\u524d\u63d0\u662f\uff0c\u6267\u884c\u8be5\u51fd\u6570\u7ec4\u4ef6"),"\uff0c\u56e0\u6b64\uff0c\u4e0a\u8ff0 Counter \u60f3\u8981\u66f4\u65b0\u8ba1\u6570\uff0c\u5c31\u4f1a\u5728\u6bcf\u6b21\u66f4\u65b0\u90fd\u6267\u884c\u4e00\u6b21 Counter \u51fd\u6570\u3002"),(0,l.kt)("p",null,"\u901a\u8fc7\u4ee5\u4e0b\u6b65\u9aa4\u5b9e\u73b0\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u65b0\u589e\u5168\u5c40\u53d8\u91cf wipFiber\uff1b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u5f53\u524d\u5de5\u4f5c\u5355\u5143 fiber\nlet wipFiber = null\nfunction updateFunctionComponent(fiber) {\n    wipFiber = fiber\n    // \u5f53\u524d\u5de5\u4f5c\u5355\u5143 fiber \u7684 hook\n    wipFiber.hook = []\n    // \u7701\u7565\n}\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"\u65b0\u589e useState \u51fd\u6570\uff1b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"// initial \u8868\u793a\u521d\u59cb\u53c2\u6570\uff0c\u5728\u672c\u4f8b\u4e2d\uff0cinitial=1\nfunction useState (initial) {\n    // \u662f\u5426\u6709\u65e7\u94a9\u5b50\uff0c\u65e7\u94a9\u5b50\u5b58\u50a8\u4e86\u4e0a\u4e00\u6b21\u66f4\u65b0\u7684 hook\n    const oldHook =\n        wipFiber.alternate &&\n        wipFiber.alternate.hook\n\n    // \u521d\u59cb\u5316\u94a9\u5b50\uff0c\u94a9\u5b50\u7684\u72b6\u6001\u662f\u65e7\u94a9\u5b50\u7684\u72b6\u6001\u6216\u8005\u521d\u59cb\u72b6\u6001\n    const hook = {\n        state: oldHook ? oldHook.state : initial,\n        queue: [],\n    }\n\n    // \u4ece\u65e7\u7684\u94a9\u5b50\u961f\u5217\u4e2d\u83b7\u53d6\u6240\u6709\u52a8\u4f5c\uff0c\u7136\u540e\u5c06\u5b83\u4eec\u4e00\u4e00\u5e94\u7528\u5230\u65b0\u7684\u94a9\u5b50\u72b6\u6001\n    const actions = oldHook ? oldHook.queue : []\n    actions.forEach(action => {\n        hook.state = action(hook.state)\n    })\n\n    // \u8bbe\u7f6e\u94a9\u5b50\u72b6\u6001\n    const setState = action => {\n        // \u5c06\u52a8\u4f5c\u6dfb\u52a0\u81f3\u94a9\u5b50\u961f\u5217\n        hook.queue.push(action)\n        // \u66f4\u65b0\u6e32\u67d3\n        wipRoot = {\n            dom: currentRoot.dom,\n            props: currentRoot.props,\n            alternate: currentRoot,\n        }\n        nextUnitOfWork = wipRoot\n        deletions = []\n    }\n\n    // \u628a\u94a9\u5b50\u6dfb\u52a0\u81f3\u5de5\u4f5c\u5355\u5143\n    wipFiber.hook = hook\n    \n    // \u8fd4\u56de\u94a9\u5b50\u7684\u72b6\u6001\u548c\u8bbe\u7f6e\u94a9\u5b50\u7684\u51fd\u6570\n    return [hook.state, setState]\n}\n")),(0,l.kt)("p",null,"\u4e0b\u9762\u8fd0\u884c\u4e00\u4e0b\u8ba1\u6570\u7ec4\u4ef6\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"function Counter() {\n    const [state, setState] = myReact.useState(1)\n    return (\n        <h1 onClick={() => setState(c => c + 1)}>\n        Count: {state}\n        </h1>\n    )\n}\nconst element = <Counter />\n")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u672c\u4f8b\u5b8c\u6574\u6e90\u7801\u89c1\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://github.com/jiaozitang/web-learn-note/blob/main/src/%E6%89%8B%E5%86%99%E7%B3%BB%E5%88%97/React/reactDemo11.html"},"reactDemo11"))),(0,l.kt)("p",null,"\u8fd0\u884c\u7ed3\u679c\u5982\u56fe\uff1a\n",(0,l.kt)("img",{parentName:"p",src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2940b3bb0bb34940891cc1903067b2b3~tplv-k3u1fbpfcp-watermark.image",alt:"123.gif"})),(0,l.kt)("p",null,"\u672c\u7ae0\u8282\u7b80\u5355\u5b9e\u73b0\u4e86 myReact \u7684 hooks \u529f\u80fd\u3002"),(0,l.kt)("p",null,"\u6492\u82b1\u5b8c\u7ed3\uff0creact \u8fd8\u6709\u5f88\u591a\u5b9e\u73b0\u503c\u5f97\u6211\u4eec\u53bb\u5b66\u4e60\u548c\u7814\u7a76\uff0c\u5e0c\u671b\u6709\u4e0b\u671f\uff0c\u548c\u5927\u5bb6\u4e00\u8d77\u624b\u5199 react \u7684\u66f4\u591a\u529f\u80fd\u3002"),(0,l.kt)("h1",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,l.kt)("p",null,"\u672c\u6587\u53c2\u8003 ",(0,l.kt)("a",{parentName:"p",href:"https://pomb.us/build-your-own-react/"},"pomb.us")," \u8fdb\u884c\u5b66\u4e60\uff0c\u5b9e\u73b0\u4e86\u5305\u62ec\u865a\u62df DOM\u3001Fiber\u3001Diff \u7b97\u6cd5\u3001\u51fd\u6570\u5f0f\u7ec4\u4ef6\u3001hooks \u7b49\u529f\u80fd\u7684\u81ea\u5b9a\u4e49 React\u3002"),(0,l.kt)("p",null,"\u5728\u5b9e\u73b0\u8fc7\u7a0b\u4e2d\u5c0f\u7f16\u5bf9 React \u7684\u57fa\u672c\u672f\u8bed\u53ca\u5b9e\u73b0\u601d\u8def\u6709\u4e86\u5927\u6982\u7684\u638c\u63e1\uff0c",(0,l.kt)("a",{parentName:"p",href:"https://pomb.us/build-your-own-react/"},"pomb.us")," \u662f\u975e\u5e38\u9002\u5408\u521d\u5b66\u8005\u7684\u5b66\u4e60\u8d44\u6599\uff0c\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 ",(0,l.kt)("a",{parentName:"p",href:"https://pomb.us/build-your-own-react/"},"pomb.us")," \u8fdb\u884c\u5b66\u4e60\uff0c\u4e5f\u63a8\u8350\u8ddf\u7740\u672c\u6587\u4e00\u6b65\u6b65\u5b9e\u73b0 React \u7684\u5e38\u89c1\u529f\u80fd\u3002"),(0,l.kt)("p",null,"\u672c\u6587\u6e90\u7801\uff1a ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/jiaozitang/web-learn-note/tree/main/src/%E6%89%8B%E5%86%99%E7%B3%BB%E5%88%97/Promise"},"github\u6e90\u7801")," \u3002"),(0,l.kt)("p",null,"\u5efa\u8bae\u8ddf\u7740\u4e00\u6b65\u6b65\u6572\uff0c\u8fdb\u884c\u5b9e\u64cd\u7ec3\u4e60\u3002"),(0,l.kt)("p",null,"\u5e0c\u671b\u80fd\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u611f\u8c22\u9605\u8bfb\uff5e"),(0,l.kt)("p",null,"\u522b\u5fd8\u4e86\u70b9\u4e2a\u8d5e\u9f13\u52b1\u4e00\u4e0b\u6211\u54e6\uff0c\u7b14\u82af\u2764\ufe0f"),(0,l.kt)("h1",{id:"\u53c2\u8003\u8d44\u6599"},"\u53c2\u8003\u8d44\u6599"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("a",{parentName:"p",href:"https://pomb.us/build-your-own-react/"},"https://pomb.us/build-your-own-react/"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("a",{parentName:"p",href:"https://www.bilibili.com/video/BV1Ki4y1u7Vr?t=78z"},"\u5361\u9882-b\u7ad9-React\u6e90\u7801\uff0c\u4f60\u5728\u7b2c\u51e0\u5c42")," ")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("a",{parentName:"p",href:"https://jelly.jd.com/article/60aceb6b27393b0169c85231"},"\u624b\u5199\u4e00\u4e2a\u7b80\u5355\u7684 React")))))}k.isMDXComponent=!0}}]);